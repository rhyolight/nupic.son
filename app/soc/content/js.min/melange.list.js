(function(){function E(q,m,s,t,w){var a=this;q=q;m=m;w=w;var z={cookie_service:{enabled:true},column_search:{enabled:true,regexp:true},columns_show_hide:{enabled:true},search_dialog:{enabled:true},csv_export:{enabled:true},global_search:{enabled:false},global_sort:{enabled:false}};this.configuration=s;this.operations=t.operations!==undefined?t.operations:{};this.templates=t.templates!==undefined?t.templates:{};this.features=t.features!==undefined?jQuery.extend(z,t.features):z;var F={datatype:function(b){r.list.process_data.retrieveData(b,
p.get(b.my_index))},viewrecords:true},A={edit:false,add:false,del:false,refreshtext:"Refresh",searchtext:"Filter",afterRefresh:function(){a.refreshData();a.jqgrid.object.trigger("reloadGrid")}};if(!a.features.search_dialog.enabled)A.search=false;this.jqgrid={id:null,object:null,options:null,last_selected_row:null,editable_columns:[],dirty_fields:{},pager:{id:null,options:null}};this.data={data:[],all_data:[],filtered_data:null};var v={enableDisableButtons:function(b){return function(f){function n(e){e=
jQuery("#"+b.jqgrid.id).jqGrid("getRowData",e);var c=e.key.toString(),d=/^<a\b[^>]*href="(.*?)" \b[^>]*>(.*?)<\/a>$/.exec(c);if(d!==null)c=d[2];var k=x.from(b.data.all_data).equals("columns.key",c).select()[0];if(b.jqgrid.dirty_fields[c]===undefined)b.jqgrid.dirty_fields[c]=[];var i=[],l=[];jQuery.each(e,function(j,o){o=o.toString();var u=/^<a\b[^>]*href="(.*?)" \b[^>]*>(.*?)<\/a>$/.exec(o);if(u!==null)o=u[2];u=k.columns[j];if(typeof u=="boolean")u=""+u;o!=u?i.push(j):l.push(j)});jQuery.each(i,function(j,
o){jQuery.inArray(o,b.jqgrid.dirty_fields[c])===-1&&b.jqgrid.dirty_fields[c].push(o)});jQuery.each(l,function(j,o){j=jQuery.inArray(o,b.jqgrid.dirty_fields[c]);j!==-1&&b.jqgrid.dirty_fields[c].splice(j,1)});b.jqgrid.dirty_fields[c].length===0&&delete b.jqgrid.dirty_fields[c];jQuery.each(b.operations.buttons,function(j,o){if(o.type==="post_edit"){j=jQuery("#"+b.jqgrid.id+"_buttonOp_"+o.id);if(jQuery.isEmptyObject(b.jqgrid.dirty_fields))j.attr("disabled","disabled");else{j.click();j.removeAttr("disabled")}}});
B()}var h=b.jqgrid.object.jqGrid("getGridParam","multiselect")?"selarrrow":"selrow",g=b.jqgrid.object.jqGrid("getGridParam",h);g instanceof Array||(g=[g]);if(g.length===1)if(f&&f!==b.jqgrid.last_selected_row){jQuery("#"+b.jqgrid.id).restoreRow(b.jqgrid.last_selected_row);jQuery("#"+b.jqgrid.id).jqGrid("editRow",f,true,null,null,"clientArray",null,n);b.jqgrid.last_selected_row=f}jQuery.each(b.operations.buttons,function(e,c){e=jQuery("#"+b.jqgrid.id+"_buttonOp_"+c.id);if(c.type!=="post_edit")if(g.length>=
c.real_bounds[0]&&g.length<=c.real_bounds[1]){e.removeAttr("disabled");if(c.real_bounds[0]===1&&c.real_bounds[1]===1&&e.data("melange")!==undefined){var d=b.jqgrid.object.jqGrid("getRowData",g[0]);d=x.from(b.data.all_data).equals("columns.key",d.key).select()[0];var k=e.data("melange").click;e.click(k(d.operations.buttons[c.id].link));e.attr("value",d.operations.buttons[c.id].caption)}}else e.attr("disabled","disabled")})}}(a),global_button_functions:{redirect_simple:function(b){return b.new_window?
function(){window.open(b.link)}:function(){window.location.href=b.link}},redirect_custom:function(b){return function(f){return b.new_window?function(){window.open(f)}:function(){window.location.href=f}}},post:function(b){return function(){var f=jQuery(this),n=f.css("color");f.attr("disabled","disabled").css("color","grey");var h=p.get(b.idx).jqgrid.object.jqGrid("getGridParam","multiselect")?"selarrrow":"selrow";h=p.get(b.idx).jqgrid.object.jqGrid("getGridParam",h);h instanceof Array||(h=h===null?
[]:[h]);var g=[];if(!(h.length<b.real_bounds[0]||h.length>b.real_bounds[1])){jQuery.each(h,function(e,c){var d=jQuery("#"+p.get(b.idx).jqgrid.id).jqGrid("getRowData",c);x.from(p.get(b.idx).all_data).equals("columns.key",d.key).select();var k={};jQuery.each(b.keys,function(i,l){i=d[l];if(jQuery(i).hasClass("listsnoul"))i=/^<a\b[^>]*>(.*?)<\/a>$/.exec(i)[1];k[l]=i});g.push(k)});if(b.url==="")b.url=window.location.href;jQuery.post(b.url,{xsrf_token:window.xsrf_token,idx:b.idx,button_id:b.button_id,data:JSON.stringify(g)},
function(e){if(b.redirect=="true")try{var c=JSON.parse(e);if(c.data.url!==undefined)window.location.href=c.data.url}catch(d){}e=parseInt(b.refresh,10);if(!isNaN(e)){p.get(e).refreshData();jQuery("#"+p.get(e).jqgrid.id).trigger("reloadGrid")}if(b.refresh=="current"){p.get(b.idx).refreshData();jQuery("#"+p.get(b.idx).jqgrid.id).trigger("reloadGrid")}else if(b.refresh=="all"){e=p.getAll();jQuery.each(e,function(k,i){i.refreshData();jQuery("#"+p.get(k).jqgrid.id).trigger("reloadGrid")})}f.removeAttr("disabled").css("color",
n)}).error(function(){f.removeAttr("disabled").css("color",n)})}}},post_edit:function(b){return function(){var f=p.get(b.idx).jqgrid,n={};if(!(f.editable_columns.length===0&&jQuery.isEmptyObject(f.dirty_fields))){f.object.jqGrid("getGridParam","records");for(var h=f.object.jqGrid("getGridParam","reccount"),g=1;g<=h;g++){var e=jQuery("#"+f.id).jqGrid("getRowData",g),c=e.key.toString(),d=/^<a\b[^>]*href="(.*?)" \b[^>]*>(.*?)<\/a>$/.exec(c);if(d!==null)c=d[2];if(f.dirty_fields[c]!==undefined){n[c]={};
jQuery.each(f.dirty_fields[c],function(k,i){k=e[i].toString();var l=/^<a\b[^>]*href="(.*?)" \b[^>]*>(.*?)<\/a>$/.exec(k);if(l!==null)k=l[2];n[c][i]=k});b.keys!==undefined&&jQuery.each(b.keys,function(k,i){if(n[c][i]===undefined){k=e[i].toString();var l=/^<a\b[^>]*href="(.*?)" \b[^>]*>(.*?)<\/a>$/.exec(k);if(l!==null)k=l[2];n[c][i]=k}})}}if(b.url==="")b.url=window.location.href;jQuery.post(b.url,{xsrf_token:window.xsrf_token,idx:b.idx,button_id:b.button_id,data:JSON.stringify(n)},function(k){if(b.redirect==
"true")try{var i=JSON.parse(k);if(i.data.url!==undefined)window.location.href=i.data.url}catch(l){}k=parseInt(b.refresh,10);if(!isNaN(k)){p.get(k).refreshData();jQuery("#"+p.get(k).jqgrid.id).trigger("reloadGrid")}if(b.refresh=="current"){p.get(b.idx).refreshData();jQuery("#"+p.get(b.idx).jqgrid.id).trigger("reloadGrid")}else if(b.refresh=="all"){k=p.getAll();jQuery.each(k,function(j,o){o.refreshData();jQuery("#"+p.get(j).jqgrid.id).trigger("reloadGrid")})}})}}}},row_functions:{redirect_custom:function(b){return function(f,
n){return b.new_window||n.which===2||n.which===1&&n.ctrlKey?function(){window.open(f)}:function(){window.location.href=f}}}}},G=function(){jQuery("#"+q).replaceWith(['<p id="temporary_list_placeholder_',m,'"></p>','<table id="'+a.jqgrid.id+'"',' cellpadding="0" cellspacing="0"></table>','<div id="'+a.jqgrid.pager.id+'"',' style="text-align:center"></div>'].join(""))},J=function(b,f){f.columns=H(f.columns);I(b,f)},I=function(b,f){if(f.operations===undefined||f.operations.row_buttons===undefined)return f;
jQuery.each(f.operations.row_buttons,function(n,h){var g={};jQuery.each(h.buttons_def,function(i,l){if(l.type==="redirect_simple"){var j="row_button_"+a.getIdx()+"_"+b+"_"+i,o="";if(l.classes!==undefined&&l.classes.length!==0)o=' class = "'+l.classes.join(" ")+'"';l=['<input type="button" value="',l.caption,'" id="',j,'"',o,"></input>"].join("");g[i]=l}});var e="";if(h.template===undefined||jQuery.trim(h.template)==="")jQuery.each(g,function(i){e+="{{ "+i+"}}"});else e=h.template;for(var c=/\{\{([^\}]+)\}\}/g,
d=e;h=c.exec(e);){var k=jQuery.trim(h[1]);if(g[k]!==undefined)d=d.replace(h[0],g[k])}f.columns[n]+=d});return f},H=function(b){if(a.templates===undefined)return b;b=b;jQuery.each(a.templates,function(f,n){for(var h,g=/\{\{([^\}]+)\}\}/g,e=n;h=g.exec(n);){var c=jQuery.trim(h[1]);if(b[c]!==undefined&&b[f]!==undefined)e=e.replace(h[0],b[c])}b[f]=e});return b},D=function(){var b="",f=0;jQuery("#load_"+a.jqgrid.id).show();var n=function(){var h="?";if(window.location.href.indexOf("?")!==-1)h="&";jQuery.ajax({async:true,
cache:false,url:[window.location.href.split("#")[0],h,"fmt=json&limit=100",b===""?"":"&start="+b,"&idx=",m].join(""),timeout:6E4,tryCount:1,retryLimit:5,error:function(g){if(g.status==500){this.tryCount++;if(this.tryCount<=this.retryLimit)jQuery.ajax(this);else{jQuery("#temporary_list_placeholder_"+m).html('<span style="color:red">Error retrieving data: please refresh the list or the whole page to try again</span>');jQuery("#load_"+a.jqgrid.id).hide()}}else{jQuery("#temporary_list_placeholder_"+m).html('<span style="color:red">Error retrieving data: please refresh the list or the whole page to try again</span>');
jQuery("#load_"+a.jqgrid.id).hide()}},success:function(g){var e=g.next==="done";if(g.data[b]!==undefined){if(a.configuration===null)a.configuration=g.configuration;if(a.operations===null)a.operations=g.operations;jQuery.each(g.data[b],function(c,d){J(c,d);a.data.data.push(d.columns);a.data.all_data.push(d)});a.jqgrid.object===null?C():a.jqgrid.object.trigger("reloadGrid");jQuery.each(a.data.all_data,function(c,d){d.operations!==undefined&&d.operations.row_buttons!==undefined&&jQuery.each(d.operations.row_buttons,
function(k,i){jQuery.each(i.buttons_def,function(l,j){l="row_button_"+a.getIdx()+"_"+c+"_"+l;j.type==="redirect_simple"&&jQuery("#"+l).click(v.global_button_functions[j.type](j.parameters))})})});if(e){jQuery("#temporary_list_placeholder_"+m).remove();jQuery("#load_"+a.jqgrid.id).hide()}else{b=g.next;setTimeout(n,100);f++}}if(e){jQuery("#temporary_list_placeholder_"+m).remove();jQuery("#load_"+a.jqgrid.id).hide();a.jqgrid.object[0].triggerToolbar!==undefined&&a.jqgrid.object[0].triggerToolbar();jQuery.each(a.configuration.colModel,
function(c,d){d.editable!==undefined&&d.editable===true&&a.jqgrid.editable_columns.push(d.name)});jQuery("#t_"+a.jqgrid.id).children().remove();a.operations!==undefined&&a.operations.buttons!==undefined&&jQuery.each(a.operations.buttons,function(c,d){c=a.jqgrid.id+"_buttonOp_"+d.id;var k=jQuery("<input type='button' value='"+d.caption+"' style='float:left' id='"+c+"'/>").button();jQuery("#t_"+a.jqgrid.id).append(k);d.parameters.idx=m;if(d.type!=="post_edit"){d.real_bounds=d.bounds;k=d.real_bounds.indexOf("all");
if(k!==-1)d.real_bounds[k]=a.jqgrid.object.jqGrid("getGridParam","records");d.parameters.real_bounds=d.real_bounds}if(d.type==="post_edit"||d.real_bounds[0]>0)jQuery("#"+c).attr("disabled","disabled");d.parameters.button_id=d.id;jQuery("#"+c).click(v.global_button_functions[d.type](d.parameters));d.type=="redirect_custom"&&jQuery("#"+c).data("melange",{click:v.global_button_functions[d.type](d.parameters)})});jQuery("#t_"+a.jqgrid.id).css("padding-bottom","3px");if(a.features.csv_export.enabled){jQuery("#t_"+
a.jqgrid.id).append("<input type='button' value='CSV Export' style='float:right;' id='csvexport_"+a.jqgrid.id+"'/>");jQuery("#csvexport_"+a.jqgrid.id).button();jQuery("#csvexport_"+a.jqgrid.id).click(function(){var c=[];c[0]=[];if(a.data.data[0]!==undefined||a.data.filtered_data[0]!==undefined){var d=a.data.filtered_data||a.data.data;jQuery.each(a.configuration.colNames,function(i,l){i=l;i=i.replace(/\"|&quot;|&#34;/g,'""');if(i.indexOf(",")!==-1||i.indexOf('"')!==-1||i.indexOf("\r\n")!==-1)i='"'+
i+'"';c[0].push(i)});c[0]=c[0].join(",");var k=[];jQuery.each(a.configuration.colModel,function(i,l){k.push(l.name)});jQuery.each(d,function(i,l){c[c.length]=[];jQuery.each(k,function(j,o){j=l[o];if(j===null)j="";if(j===undefined)j="";j=j.toString();o=/^<a\b[^>]*href="(.*?)" \b[^>]*>(.*?)<\/a>$/.exec(j);if(o!==null)j=o[1];j=j.replace(/\"|&quot;|&#34;/g,'""');if(j.indexOf(",")!==-1||j.indexOf('"')!==-1||j.indexOf("\r\n")!==-1)j='"'+j+'"';c[c.length-1].push(j)});c[c.length-1]=c[c.length-1].join(",")});
c=c.join("\r\n");jQuery("#csv_dialog").remove();jQuery("body").append(["<div id='csv_dialog' style='display:none'>  <h3>Now you can copy and paste CSV data from the text area to a new file:</h3>  <textarea style='width:450px;height:250px'>",c,"</textarea></div>"].join(""));jQuery("#csv_dialog").dialog({height:420,width:500,modal:true,buttons:{Close:function(){jQuery(this).dialog("close")}}})}})}if(a.features.column_search.enabled&&a.features.column_search.regexp){jQuery("#t_"+a.jqgrid.id).append("<div style='float:right;margin-right:4px;'><input type='checkbox' id='regexp_"+
a.jqgrid.id+"'/>RegExp Search</div>");jQuery("#regexp_"+a.jqgrid.id).click(function(){jQuery("#"+a.jqgrid.id).jqGrid().trigger("reloadGrid")})}g=jQuery.Event("melange_list_loaded");g.list_object=a;a.jqgrid.object.trigger(g);g=jQuery("#gview_"+a.jqgrid.id+" .ui-jqgrid-bdiv");g.width(g.width()+1)}}})};setTimeout(n,100)};this.refreshData=function(){a.data={data:[],all_data:[],filtered_data:null};D()};var B=function(){if(a.configuration.footerrow){var b={},f=a.jqgrid.object;jQuery.each(a.configuration.colModel,
function(n,h){if(h.summaryType!==undefined){n=f.jqGrid("getCol",h.name,false,h.summaryType);b[h.name]=h.summaryTpl.replace(/\{0\}/ig,n)}});f.jqGrid("footerData","set",b)}},K=function(){if(a.jqgrid.object){B();a.features.cookie_service.enabled&&r.list.cookie_service.saveCurrentTableConfiguration(m,a.jqgrid.object)}},C=function(){if(a.features.cookie_service.enabled)a.configuration=r.list.cookie_service.getPreviousTableConfiguration(m,a.configuration);var b=jQuery.extend(a.configuration,{postData:{my_index:m},
onSelectAll:v.enableDisableButtons,onSelectRow:v.enableDisableButtons,gridComplete:K,altRows:true,altclass:"alternate_row"}),f={caption:"Columns",buttonicon:"ui-icon-calculator",onClickButton:function(){var g=jQuery("#"+a.jqgrid.id).jqGrid("getGridParam","width");jQuery("#"+a.jqgrid.id).jqGrid("columnChooser",{done:function(e){if(e){this.jqGrid("remapColumns",e,true);this.jqGrid("setGridWidth",g);r.list.cookie_service.saveCurrentTableConfiguration(m,a.jqgrid.object)}}})},position:"last",title:"Show/Hide Columns",
cursor:"pointer"},n={};if(a.features.column_search.enabled)n={closeAfterSearch:true,multipleSearch:true};jQuery("#"+a.jqgrid.id).jqGrid(jQuery.extend(a.jqgrid.options,b)).jqGrid("navGrid","#"+a.jqgrid.pager.id,a.jqgrid.pager.options,{},{},{},n,{});a.features.columns_show_hide.enabled&&jQuery("#"+a.jqgrid.id).jqGrid("navButtonAdd","#"+a.jqgrid.pager.id,f);a.features.column_search.enabled&&jQuery("#"+a.jqgrid.id).jqGrid("filterToolbar",{beforeSearch:function(){r.list.cookie_service.saveCurrentTableConfiguration(m,
a.jqgrid.object)},searchOnEnter:false,autosearch:true});jQuery("#load_"+a.jqgrid.id).closest("div").css("line-height","100%");jQuery("#load_"+a.jqgrid.id).html("<img src='/soc/content/"+r.config.app_version+"/images/jqgrid_loading.gif'></img>");a.jqgrid.object=jQuery("#"+a.jqgrid.id);a.features.global_search.enabled&&jQuery(a.features.global_search.element_path).bind("keyup",function(){var g=jQuery(a.features.global_search.element_path).val(),e=a.jqgrid.object.jqGrid("getGridParam","postData");e._search=
true;e.filters={groupOp:"OR",rules:[]};jQuery.each(a.configuration.colModel,function(c,d){e.filters.rules.push({field:d.name,op:"cn",data:g})});e.filters=JSON.stringify(e.filters);a.jqgrid.object.jqGrid("setGridParam",{search:true,postData:e});a.jqgrid.object.trigger("reloadGrid")});b=a.features.global_sort;if(b.enabled){if(b.element_paths.column!==undefined){var h=jQuery(b.element_paths.column);jQuery(" option",h).remove();jQuery.each(a.configuration.colModel,function(g,e){h.append(jQuery("<option></option>").val(e.name).html(a.configuration.colNames[g]))});
f=a.jqgrid.object.jqGrid("getGridParam","postData").sidx;h.val(f);h.bind("change",function(){var g=jQuery(this).val();a.jqgrid.object.jqGrid("setGridParam",{sortname:g});a.jqgrid.object.trigger("reloadGrid")})}if(b.element_paths.asc_desc!==undefined){h=jQuery(b.element_paths.asc_desc);jQuery(" option",h).remove();h.append(jQuery("<option></option>").val("asc").html("Ascending"));h.append(jQuery("<option></option>").val("desc").html("Descending"));f=a.jqgrid.object.jqGrid("getGridParam","postData").sord;
h.val(f);h.bind("change",function(){var g=jQuery(this).val();a.jqgrid.object.jqGrid("setGridParam",{sortorder:g});a.jqgrid.object.trigger("reloadGrid")})}}};this.getDiv=function(){return q};this.getIdx=function(){return m};this.init=function(){jQuery(function(){if(jQuery("#"+q).length===0)throw new r.error.divNotExistent("Div "+q+" is not existent");a.jqgrid.id="jqgrid_"+q;a.jqgrid.pager.id="jqgrid_pager_"+q;a.jqgrid.options=jQuery.extend(F,{pager:"#"+a.jqgrid.pager.id});a.jqgrid.pager.options=A;
p.add(a);G();C();D()})};w!==undefined&&w===true?this.init():p.add(this)}if(window.melange===undefined)throw new Error("Melange not loaded");var r=window.melange;if(window.jLinq===undefined)throw new Error("jLinq not loaded");var x=window.jLinq;r.list=window.melange.list=function(){return new r.list};var y=r.logging.debugDecorator(r.list);r.error.createErrors(["listIndexNotValid","divNotExistent","indexAlreadyExistent"]);y.list_objects=function(){var q=[];return{add:function(m){q[m.getIdx()]=m},get:function(m){return q[m]!==
undefined?q[m]:null},getAll:function(){return jQuery.extend({},q)},isExistent:function(m){return q[m]!==undefined?true:false}}}();var p=y.list_objects;y.loadList=function(q,m,s,t){s=parseInt(s,10);m=JSON.parse(m);if(isNaN(s)||s<0)throw new r.error.listIndexNotValid("List index "+s+" is not valid");if(p.isExistent(s))throw new r.error.indexAlreadyExistent("Index "+s+" is already existent");new E(q,s,m.configuration,m,t)}})();
