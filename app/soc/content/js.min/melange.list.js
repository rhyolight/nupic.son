(function(){function F(q,l,s,t,x){var a=this;q=q;l=l;x=x;var A={cookie_service:{enabled:true},column_search:{enabled:true,regexp:true},columns_show_hide:{enabled:true},search_dialog:{enabled:true},csv_export:{enabled:true},global_search:{enabled:false},global_sort:{enabled:false}};this.configuration=s;this.operations=t.operations!==undefined?t.operations:{};this.templates=t.templates!==undefined?t.templates:{};this.features=t.features!==undefined?jQuery.extend(A,t.features):A;var G={datatype:function(b){r.list.process_data.retrieveData(b,
p.get(b.my_index))},viewrecords:true},B={edit:false,add:false,del:false,refreshtext:"Refresh",searchtext:"Filter",afterRefresh:function(){a.refreshData();a.jqgrid.object.trigger("reloadGrid")}};if(!a.features.search_dialog.enabled)B.search=false;this.jqgrid={id:null,object:null,options:null,last_selected_row:null,editable_columns:[],dirty_fields:{},pager:{id:null,options:null}};this.data={data:[],all_data:[],filtered_data:null};var w={enableDisableButtons:function(b){return function(g){function m(i){i=
jQuery("#"+b.jqgrid.id).jqGrid("getRowData",i);var c=i.key.toString(),e=/^<a\b[^>]*href="(.*?)" \b[^>]*>(.*?)<\/a>$/.exec(c);if(e!==null)c=e[2];var h=v.from(b.data.all_data).equals("columns.key",c).select()[0];if(b.jqgrid.dirty_fields[c]===undefined)b.jqgrid.dirty_fields[c]=[];var k=[],n=[];jQuery.each(i,function(j,o){o=o.toString();var u=/^<a\b[^>]*href="(.*?)" \b[^>]*>(.*?)<\/a>$/.exec(o);if(u!==null)o=u[2];u=h.columns[j];if(typeof u=="boolean")u=""+u;o!=u?k.push(j):n.push(j)});jQuery.each(k,function(j,
o){jQuery.inArray(o,b.jqgrid.dirty_fields[c])===-1&&b.jqgrid.dirty_fields[c].push(o)});jQuery.each(n,function(j,o){j=jQuery.inArray(o,b.jqgrid.dirty_fields[c]);j!==-1&&b.jqgrid.dirty_fields[c].splice(j,1)});b.jqgrid.dirty_fields[c].length===0&&delete b.jqgrid.dirty_fields[c];jQuery.each(b.operations.buttons,function(j,o){if(o.type==="post_edit"){j=jQuery("#"+b.jqgrid.id+"_buttonOp_"+o.id);if(jQuery.isEmptyObject(b.jqgrid.dirty_fields))j.attr("disabled","disabled");else{j.click();j.removeAttr("disabled")}}});
C()}var f=b.jqgrid.object.jqGrid("getGridParam","multiselect")?"selarrrow":"selrow",d=b.jqgrid.object.jqGrid("getGridParam",f);d instanceof Array||(d=[d]);if(d.length===1)if(g&&g!==b.jqgrid.last_selected_row){jQuery("#"+b.jqgrid.id).restoreRow(b.jqgrid.last_selected_row);jQuery("#"+b.jqgrid.id).jqGrid("editRow",g,true,null,null,"clientArray",null,m);b.jqgrid.last_selected_row=g}jQuery.each(b.operations.buttons,function(i,c){i=jQuery("#"+b.jqgrid.id+"_buttonOp_"+c.id);if(c.type!=="post_edit")if(d.length>=
c.real_bounds[0]&&d.length<=c.real_bounds[1]){i.removeAttr("disabled");if(c.real_bounds[0]===1&&c.real_bounds[1]===1&&i.data("melange")!==undefined){var e=b.jqgrid.object.jqGrid("getRowData",d[0]);e=v.from(b.data.all_data).equals("columns.key",e.key).select()[0];var h=i.data("melange").click;i.click(h(e.operations.buttons[c.id].link));i.attr("value",e.operations.buttons[c.id].caption)}}else i.attr("disabled","disabled")})}}(a),global_button_functions:{redirect_simple:function(b){return b.new_window?
function(){window.open(b.link)}:function(){window.location.href=b.link}},redirect_custom:function(b){return function(g){return b.new_window?function(){window.open(g)}:function(){window.location.href=g}}},post:function(b){return function(){var g=p.get(b.idx).jqgrid.object.jqGrid("getGridParam","multiselect")?"selarrrow":"selrow";g=p.get(b.idx).jqgrid.object.jqGrid("getGridParam",g);g instanceof Array||(g=g===null?[]:[g]);var m=[];if(!(g.length<b.real_bounds[0]||g.length>b.real_bounds[1])){jQuery.each(g,
function(f,d){var i=jQuery("#"+p.get(b.idx).jqgrid.id).jqGrid("getRowData",d);v.from(p.get(b.idx).all_data).equals("columns.key",i.key).select();var c={};jQuery.each(b.keys,function(e,h){e=i[h];if(jQuery(e).hasClass("listsnoul"))e=/^<a\b[^>]*>(.*?)<\/a>$/.exec(e)[1];c[h]=e});m.push(c)});if(b.url==="")b.url=window.location.href;jQuery.post(b.url,{xsrf_token:window.xsrf_token,idx:b.idx,button_id:b.button_id,data:JSON.stringify(m)},function(f){if(b.redirect=="true")try{var d=JSON.parse(f);if(d.data.url!==
undefined)window.location.href=d.data.url}catch(i){}f=parseInt(b.refresh,10);if(!isNaN(f)){p.get(f).refreshData();jQuery("#"+p.get(f).jqgrid.id).trigger("reloadGrid")}if(b.refresh=="current"){p.get(b.idx).refreshData();jQuery("#"+p.get(b.idx).jqgrid.id).trigger("reloadGrid")}else if(b.refresh=="all"){f=p.getAll();jQuery.each(f,function(c,e){e.refreshData();jQuery("#"+p.get(c).jqgrid.id).trigger("reloadGrid")})}})}}},post_edit:function(b){return function(){var g=p.get(b.idx).jqgrid,m={};if(!(g.editable_columns.length===
0&&jQuery.isEmptyObject(g.dirty_fields))){g.object.jqGrid("getGridParam","records");for(var f=g.object.jqGrid("getGridParam","reccount"),d=1;d<=f;d++){var i=jQuery("#"+g.id).jqGrid("getRowData",d),c=i.key.toString(),e=/^<a\b[^>]*href="(.*?)" \b[^>]*>(.*?)<\/a>$/.exec(c);if(e!==null)c=e[2];if(g.dirty_fields[c]!==undefined){m[c]={};jQuery.each(g.dirty_fields[c],function(h,k){h=i[k].toString();var n=/^<a\b[^>]*href="(.*?)" \b[^>]*>(.*?)<\/a>$/.exec(h);if(n!==null)h=n[2];m[c][k]=h});b.keys!==undefined&&
jQuery.each(b.keys,function(h,k){if(m[c][k]===undefined){h=i[k].toString();var n=/^<a\b[^>]*href="(.*?)" \b[^>]*>(.*?)<\/a>$/.exec(h);if(n!==null)h=n[2];m[c][k]=h}})}}if(b.url==="")b.url=window.location.href;jQuery.post(b.url,{xsrf_token:window.xsrf_token,idx:b.idx,button_id:b.button_id,data:JSON.stringify(m)},function(h){if(b.redirect=="true")try{var k=JSON.parse(h);if(k.data.url!==undefined)window.location.href=k.data.url}catch(n){}h=parseInt(b.refresh,10);if(!isNaN(h)){p.get(h).refreshData();jQuery("#"+
p.get(h).jqgrid.id).trigger("reloadGrid")}if(b.refresh=="current"){p.get(b.idx).refreshData();jQuery("#"+p.get(b.idx).jqgrid.id).trigger("reloadGrid")}else if(b.refresh=="all"){h=p.getAll();jQuery.each(h,function(j,o){o.refreshData();jQuery("#"+p.get(j).jqgrid.id).trigger("reloadGrid")})}})}}}},row_functions:{redirect_custom:function(b){return function(g,m){return b.new_window||m.which===2||m.which===1&&m.ctrlKey?function(){window.open(g)}:function(){window.location.href=g}}}}},H=function(){jQuery("#"+
q).replaceWith(['<p id="temporary_list_placeholder_',l,'"></p>','<table id="'+a.jqgrid.id+'"',' cellpadding="0" cellspacing="0"></table>','<div id="'+a.jqgrid.pager.id+'"',' style="text-align:center"></div>'].join(""))},K=function(b,g){g.columns=I(g.columns);J(b,g)},J=function(b,g){if(g.operations===undefined||g.operations.row_buttons===undefined)return g;jQuery.each(g.operations.row_buttons,function(m,f){var d={};jQuery.each(f.buttons_def,function(k,n){if(n.type==="redirect_simple"){var j="row_button_"+
a.getIdx()+"_"+b+"_"+k,o="";if(n.classes!==undefined&&n.classes.length!==0)o=' class = "'+n.classes.join(" ")+'"';n=['<input type="button" value="',n.caption,'" id="',j,'"',o,"></input>"].join("");d[k]=n}});var i="";if(f.template===undefined||jQuery.trim(f.template)==="")jQuery.each(d,function(k){i+="{{ "+k+"}}"});else i=f.template;for(var c=/\{\{([^\}]+)\}\}/g,e=i;f=c.exec(i);){var h=jQuery.trim(f[1]);if(d[h]!==undefined)e=e.replace(f[0],d[h])}g.columns[m]+=e});return g},I=function(b){if(a.templates===
undefined)return b;b=b;jQuery.each(a.templates,function(g,m){for(var f,d=/\{\{([^\}]+)\}\}/g,i=m;f=d.exec(m);){var c=jQuery.trim(f[1]);if(b[c]!==undefined&&b[g]!==undefined)i=i.replace(f[0],b[c])}b[g]=i});return b},E=function(){var b="",g=0;jQuery("#load_"+a.jqgrid.id).show();var m=function(){var f="?";if(window.location.href.indexOf("?")!==-1)f="&";jQuery.ajax({async:true,cache:false,url:[window.location.href.split("#")[0],f,"fmt=json&limit=150",b===""?"":"&start="+b,"&idx=",l].join(""),timeout:6E4,
tryCount:1,retryLimit:5,error:function(d){if(d.status==500){this.tryCount++;if(this.tryCount<=this.retryLimit)jQuery.ajax(this);else{jQuery("#temporary_list_placeholder_"+l).html('<span style="color:red">Error retrieving data: please refresh the list or the whole page to try again</span>');jQuery("#load_"+a.jqgrid.id).hide()}}else{jQuery("#temporary_list_placeholder_"+l).html('<span style="color:red">Error retrieving data: please refresh the list or the whole page to try again</span>');jQuery("#load_"+
a.jqgrid.id).hide()}},success:function(d){var i=d.next==="done";if(d.data[b]!==undefined){if(a.configuration===null)a.configuration=d.configuration;if(a.operations===null)a.operations=d.operations;jQuery.each(d.data[b],function(c,e){K(c,e);a.data.data.push(e.columns);a.data.all_data.push(e)});a.jqgrid.object===null?D():a.jqgrid.object.trigger("reloadGrid");jQuery.each(a.data.all_data,function(c,e){e.operations!==undefined&&e.operations.row_buttons!==undefined&&jQuery.each(e.operations.row_buttons,
function(h,k){jQuery.each(k.buttons_def,function(n,j){n="row_button_"+a.getIdx()+"_"+c+"_"+n;j.type==="redirect_simple"&&jQuery("#"+n).click(w.global_button_functions[j.type](j.parameters))})})});if(i){jQuery("#temporary_list_placeholder_"+l).remove();jQuery("#load_"+a.jqgrid.id).hide()}else{b=d.next;setTimeout(m,100);g++}}if(i){jQuery("#temporary_list_placeholder_"+l).remove();jQuery("#load_"+a.jqgrid.id).hide();a.jqgrid.object.triggerToolbar!==undefined&&a.jqgrid.object.triggerToolbar();jQuery.each(a.configuration.colModel,
function(c,e){e.editable!==undefined&&e.editable===true&&a.jqgrid.editable_columns.push(e.name)});jQuery("#t_"+a.jqgrid.id).children().remove();a.operations!==undefined&&a.operations.buttons!==undefined&&jQuery.each(a.operations.buttons,function(c,e){c=a.jqgrid.id+"_buttonOp_"+e.id;var h=jQuery("<input type='button' value='"+e.caption+"' style='float:left' id='"+c+"'/>").button();jQuery("#t_"+a.jqgrid.id).append(h);e.parameters.idx=l;if(e.type!=="post_edit"){e.real_bounds=e.bounds;h=e.real_bounds.indexOf("all");
if(h!==-1)e.real_bounds[h]=a.jqgrid.object.jqGrid("getGridParam","records");e.parameters.real_bounds=e.real_bounds}if(e.type==="post_edit"||e.real_bounds[0]>0)jQuery("#"+c).attr("disabled","disabled");e.parameters.button_id=e.id;jQuery("#"+c).click(w.global_button_functions[e.type](e.parameters));e.type=="redirect_custom"&&jQuery("#"+c).data("melange",{click:w.global_button_functions[e.type](e.parameters)})});jQuery("#t_"+a.jqgrid.id).css("padding-bottom","3px");if(a.features.csv_export.enabled){jQuery("#t_"+
a.jqgrid.id).append("<input type='button' value='CSV Export' style='float:right;' id='csvexport_"+a.jqgrid.id+"'/>");jQuery("#csvexport_"+a.jqgrid.id).button();jQuery("#csvexport_"+a.jqgrid.id).click(function(){var c=[];c[0]=[];if(a.data.data[0]!==undefined||a.data.filtered_data[0]!==undefined){var e=a.data.filtered_data||a.data.data;jQuery.each(a.configuration.colNames,function(k,n){k=n;k=k.replace(/\"|&quot;|&#34;/g,'""');if(k.indexOf(",")!==-1||k.indexOf('"')!==-1||k.indexOf("\r\n")!==-1)k='"'+
k+'"';c[0].push(k)});c[0]=c[0].join(",");var h=[];jQuery.each(a.configuration.colModel,function(k,n){h.push(n.name)});jQuery.each(e,function(k,n){c[c.length]=[];jQuery.each(h,function(j,o){j=n[o];if(j===null)j="";if(j===undefined)j="";j=j.toString();o=/^<a\b[^>]*href="(.*?)" \b[^>]*>(.*?)<\/a>$/.exec(j);if(o!==null)j=o[1];j=j.replace(/\"|&quot;|&#34;/g,'""');if(j.indexOf(",")!==-1||j.indexOf('"')!==-1||j.indexOf("\r\n")!==-1)j='"'+j+'"';c[c.length-1].push(j)});c[c.length-1]=c[c.length-1].join(",")});
c=c.join("\r\n");jQuery("#csv_dialog").remove();jQuery("body").append(["<div id='csv_dialog' style='display:none'>  <h3>Now you can copy and paste CSV data from the text area to a new file:</h3>  <textarea style='width:450px;height:250px'>",c,"</textarea></div>"].join(""));jQuery("#csv_dialog").dialog({height:420,width:500,modal:true,buttons:{Close:function(){jQuery(this).dialog("close")}}})}})}if(a.features.column_search.enabled&&a.features.column_search.regexp){jQuery("#t_"+a.jqgrid.id).append("<div style='float:right;margin-right:4px;'><input type='checkbox' id='regexp_"+
a.jqgrid.id+"'/>RegExp Search</div>");jQuery("#regexp_"+a.jqgrid.id).click(function(){jQuery("#"+a.jqgrid.id).jqGrid().trigger("reloadGrid")})}d=jQuery.Event("melange_list_loaded");d.list_object=a;a.jqgrid.object.trigger(d);d=jQuery("#gview_"+a.jqgrid.id+" .ui-jqgrid-bdiv");d.width(d.width()+1)}}})};setTimeout(m,100)};this.refreshData=function(){a.data={data:[],all_data:[],filtered_data:null};E()};var y=new (function(){var b=function(f){var d={hidden_columns:{}};jQuery.each(f,function(i,c){d.hidden_columns[c.name]=
c.hidden});return d},g=function(f,d){return{sort_settings:{sortname:f,sortorder:d}}},m=function(f,d){var i={filters:{}};d._search===true&&jQuery.each(f,function(c,e){if(d[e.name]!==undefined)i.filters[e.name]=d[e.name]});return i};this.saveCurrentTableConfiguration=function(){var f=r.cookie.getCookie(r.cookie.MELANGE_USER_PREFERENCES),d=a.jqgrid.object.jqGrid("getGridParam","colModel"),i=a.jqgrid.object.jqGrid("getGridParam","sortname"),c=a.jqgrid.object.jqGrid("getGridParam","sortorder"),e=a.jqgrid.object.jqGrid("getGridParam",
"postData"),h=b(d);h=jQuery.extend(g(i,c),h);h=jQuery.extend(m(d,e),h);d={lists_configuration:{}};d.lists_configuration[l]=h;d.lists_configuration=jQuery.extend(f.lists_configuration,d.lists_configuration);r.cookie.saveCookie(r.cookie.MELANGE_USER_PREFERENCES,d,14,window.location.pathname)};this.getPreviousTableConfiguration=function(f){var d=r.cookie.getCookie(r.cookie.MELANGE_USER_PREFERENCES),i=f.colModel;if(d.lists_configuration[l]!==undefined){jQuery.each(d.lists_configuration[l].hidden_columns,
function(h,k){h=v.from(i).equals("name",h).select()[0]||null;if(h!==null)h.hidden=k});if(d.lists_configuration[l].sort_settings!==undefined){var c=d.lists_configuration[l].sort_settings.sortname,e=d.lists_configuration[l].sort_settings.sortorder;if(v.from(i).equals("name",c).select()[0]!==undefined?true:false){f.sortname=c;f.sortorder=e}}d.lists_configuration[l].filters!==undefined&&jQuery.each(d.lists_configuration[l].filters,function(h,k){h=v.from(i).equals("name",h).select()[0];if(h!==undefined)h.searchoptions=
{defaultValue:k}})}return f}}),C=function(){if(a.configuration.footerrow){var b={},g=a.jqgrid.object;jQuery.each(a.configuration.colModel,function(m,f){if(f.summaryType!==undefined){m=g.jqGrid("getCol",f.name,false,f.summaryType);b[f.name]=f.summaryTpl.replace(/\{0\}/ig,m)}});g.jqGrid("footerData","set",b)}},L=function(){if(a.jqgrid.object){C();a.features.cookie_service.enabled&&y.saveCurrentTableConfiguration()}},D=function(){if(a.features.cookie_service.enabled)a.configuration=y.getPreviousTableConfiguration(a.configuration);
var b=jQuery.extend(a.configuration,{postData:{my_index:l},onSelectAll:w.enableDisableButtons,onSelectRow:w.enableDisableButtons,gridComplete:L}),g={caption:"Columns",buttonicon:"ui-icon-calculator",onClickButton:function(){jQuery("#"+a.jqgrid.id).setColumns({colnameview:false,jqModal:true,ShrinkToFit:true,afterSubmitForm:y.saveCurrentTableConfiguration,recreateForm:true});return false},position:"last",title:"Show/Hide Columns",cursor:"pointer"},m={};if(a.features.column_search.enabled)m={closeAfterSearch:true,
multipleSearch:true};jQuery("#"+a.jqgrid.id).jqGrid(jQuery.extend(a.jqgrid.options,b)).jqGrid("navGrid","#"+a.jqgrid.pager.id,a.jqgrid.pager.options,{},{},{},m,{});a.features.columns_show_hide.enabled&&jQuery("#"+a.jqgrid.id).jqGrid("navButtonAdd","#"+a.jqgrid.pager.id,g);a.features.column_search.enabled&&jQuery("#"+a.jqgrid.id).jqGrid("filterToolbar",{beforeSearch:y.saveCurrentTableConfiguration,searchOnEnter:false,autosearch:true});jQuery("#load_"+a.jqgrid.id).closest("div").css("line-height","100%");
jQuery("#load_"+a.jqgrid.id).html("<img src='/soc/content/"+r.config.app_version+"/images/jqgrid_loading.gif'></img>");a.jqgrid.object=jQuery("#"+a.jqgrid.id);a.features.global_search.enabled&&jQuery(a.features.global_search.element_path).bind("keyup",function(){var d=jQuery(a.features.global_search.element_path).val(),i=a.jqgrid.object.jqGrid("getGridParam","postData");i._search=true;i.filters={groupOp:"OR",rules:[]};jQuery.each(a.configuration.colModel,function(c,e){i.filters.rules.push({field:e.name,
op:"cn",data:d})});i.filters=JSON.stringify(i.filters);a.jqgrid.object.jqGrid("setGridParam",{search:true,postData:i});a.jqgrid.object.trigger("reloadGrid")});b=a.features.global_sort;if(b.enabled){if(b.element_paths.column!==undefined){var f=jQuery(b.element_paths.column);jQuery(" option",f).remove();jQuery.each(a.configuration.colModel,function(d,i){f.append(jQuery("<option></option>").val(i.name).html(a.configuration.colNames[d]))});g=a.jqgrid.object.jqGrid("getGridParam","postData").sidx;f.val(g);
f.bind("change",function(){var d=jQuery(this).val();a.jqgrid.object.jqGrid("setGridParam",{sortname:d});a.jqgrid.object.trigger("reloadGrid")})}if(b.element_paths.asc_desc!==undefined){f=jQuery(b.element_paths.asc_desc);jQuery(" option",f).remove();f.append(jQuery("<option></option>").val("asc").html("Ascending"));f.append(jQuery("<option></option>").val("desc").html("Descending"));g=a.jqgrid.object.jqGrid("getGridParam","postData").sord;f.val(g);f.bind("change",function(){var d=jQuery(this).val();
a.jqgrid.object.jqGrid("setGridParam",{sortorder:d});a.jqgrid.object.trigger("reloadGrid")})}}};this.getDiv=function(){return q};this.getIdx=function(){return l};this.init=function(){jQuery(function(){if(jQuery("#"+q).length===0)throw new r.error.divNotExistent("Div "+q+" is not existent");a.jqgrid.id="jqgrid_"+q;a.jqgrid.pager.id="jqgrid_pager_"+q;a.jqgrid.options=jQuery.extend(G,{pager:"#"+a.jqgrid.pager.id});a.jqgrid.pager.options=B;p.add(a);H();D();E()})};x!==undefined&&x===true?this.init():p.add(this)}
if(window.melange===undefined)throw new Error("Melange not loaded");var r=window.melange;if(window.jLinq===undefined)throw new Error("jLinq not loaded");var v=window.jLinq;r.list=window.melange.list=function(){return new r.list};var z=r.logging.debugDecorator(r.list);r.error.createErrors(["listIndexNotValid","divNotExistent","indexAlreadyExistent"]);z.list_objects=function(){var q=[];return{add:function(l){q[l.getIdx()]=l},get:function(l){return q[l]!==undefined?q[l]:null},getAll:function(){return jQuery.extend({},
q)},isExistent:function(l){return q[l]!==undefined?true:false}}}();var p=z.list_objects;z.loadList=function(q,l,s,t){s=parseInt(s,10);l=JSON.parse(l);if(isNaN(s)||s<0)throw new r.error.listIndexNotValid("List index "+s+" is not valid");if(p.isExistent(s))throw new r.error.indexAlreadyExistent("Index "+s+" is already existent");new F(q,s,l.configuration,l,t)}})();
