(function(d){if(window.melange===undefined)throw new Error("Melange not loaded");var e=window.melange;e.getUploadUrl=function(){var c="?";if(window.location.href.indexOf("?")!==-1)c="&";var a;jQuery.ajax({async:false,cache:false,url:[window.location.href,c,"fmt=json"].join(""),dataType:"json",success:function(b){a=b.upload_link},error:function(b,g,f){alert("Could not retrieve upload url: '"+f+"'.")}});return a};e.asyncUpload=function(c){c=c.join(", ");jQuery(c).bind("fileuploadsubmit",function(a,
b){b.url=e.getUploadUrl();a=d(this).parent().parent();a.hide();a.parent().children(".progress").show()});jQuery(c).fileupload({progressall:function(a,b){a=parseInt(b.loaded/b.total*100,10);d(".progress .bar").css("width",a+"%")},done:function(a,b){a=d(this).parent().parent().parent();a.children(".progress").hide();a=a.children(".filedownload");a.children(".filename").html(b.files[0].name);a.show()}})}})(jQuery);
