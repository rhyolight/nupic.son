(function(){if(window.melange===undefined)throw new Error("Melange not loaded");var g=window.melange;if(window.melange.list===undefined)throw new Error("melange.list not loaded");if(window.jLinq===undefined)throw new Error("jLinq not loaded");var j=window.jLinq;g.list.cookie_service=window.melange.list.cookie_service=function(){return new g.list.cookie_service};var n=g.logging.debugDecorator(g.list.cookie_service),s=function(c){var a={hidden_columns:{}};jQuery.each(c,function(b,e){a.hidden_columns[e.name]=
e.hidden});return a},t=function(c,a){return{sort_settings:{sortname:c,sortorder:a}}},u=function(c,a){var b={filters:{}};a._search===true&&jQuery.each(c,function(e,f){if(a[f.name]!==undefined)b.filters[f.name]=a[f.name]});return b},v=function(c){var a={column_widths:{}};jQuery.each(c,function(b,e){if(e.width!==undefined)a.column_widths[e.name]=e.width});return a},w=function(c){var a={columns_order:{}},b=0;if(c[0].name==="cb")b=1;jQuery.each(c,function(e,f){if(f.name!=="cb")a.columns_order[f.name]=
e-b});return a};n.saveCurrentTableConfiguration=function(c,a,b){b=typeof b!=="undefined"?b:false;var e=g.cookie.getCookie(g.cookie.MELANGE_USER_PREFERENCES);if(e.lists_configuration[c]!==undefined&&e.lists_configuration[c].column_widths!==undefined)b=true;var f=a.jqGrid("getGridParam","colModel"),k=a.jqGrid("getGridParam","sortname"),l=a.jqGrid("getGridParam","sortorder"),i=a.jqGrid("getGridParam","postData");a=s(f);a=jQuery.extend(t(k,l),a);a=jQuery.extend(u(f,i),a);if(b===true)a=jQuery.extend(v(f),
a);a=jQuery.extend(w(f),a);b={lists_configuration:{}};b.lists_configuration[c]=a;b.lists_configuration=jQuery.extend(e.lists_configuration,b.lists_configuration);g.cookie.saveCookie(g.cookie.MELANGE_USER_PREFERENCES,b,14,window.location.pathname)};n.getPreviousTableConfiguration=function(c,a){var b=g.cookie.getCookie(g.cookie.MELANGE_USER_PREFERENCES),e=a.colModel,f=a.colNames;if(b.lists_configuration[c]!==undefined){jQuery.each(b.lists_configuration[c].hidden_columns,function(d,h){d=j.from(e).equals("name",
d).select()[0]||null;if(d!==null)d.hidden=h});if(b.lists_configuration[c].sort_settings!==undefined){var k=b.lists_configuration[c].sort_settings.sortname,l=b.lists_configuration[c].sort_settings.sortorder;if(j.from(e).equals("name",k).select()[0]!==undefined?true:false){a.sortname=k;a.sortorder=l}}b.lists_configuration[c].filters!==undefined&&jQuery.each(b.lists_configuration[c].filters,function(d,h){d=j.from(e).equals("name",d).select()[0];if(d!==undefined)d.searchoptions={defaultValue:h}});b.lists_configuration[c].column_widths!==
undefined&&jQuery.each(b.lists_configuration[c].column_widths,function(d,h){d=j.from(e).equals("name",d).select()[0];if(d!==undefined){a.shrinkToFit=false;d.width=h}});if(b.lists_configuration[c].columns_order!==undefined){var i=b.lists_configuration[c].columns_order,o=[],p=[],q=[],r=[];jQuery.each(e,function(d,h){var m=h.name;if(i[m]!==undefined){o[i[m]]=h;p[i[m]]=f[d]}else{q.push(h);r.push(f[d])}});a.colModel=jQuery.merge(o,q);a.colNames=jQuery.merge(p,r);a.colModel=jQuery.grep(a.colModel,function(d){return typeof d!==
"undefined"});a.colNames=jQuery.grep(a.colNames,function(d){return typeof d!=="undefined"})}}return a}})();
