(function(){if(window.melange===undefined)throw new Error("Melange not loaded");var o=window.melange;if(window.melange.list===undefined)throw new Error("melange.list not loaded");if(window.jLinq===undefined)throw new Error("jLinq not loaded");var h=window.jLinq;o.list.process_data=window.melange.list.process_data=function(){return new o.list.process_data};o.logging.debugDecorator(o.list.process_data).retrieveData=function(e,f){var k=f.data.data,c=k,p="",m={eq:{method:"equals",not:false},ne:{method:"equals",
not:true},lt:{method:"less",not:false},le:{method:"lessEquals",not:false},gt:{method:"greater",not:false},ge:{method:"greaterEquals",not:false},bw:{method:"startsWith",not:false},bn:{method:"startsWith",not:true},ew:{method:"endsWith",not:false},en:{method:"endsWith",not:true},cn:{method:"contains",not:false},nc:{method:"contains",not:true},"in":{method:"match",not:false},ni:{method:"match",not:true}};if(e._search&&e.filters){var i=JSON.parse(e.filters);if(i.rules[0].data!==""){p=i.groupOp;if(p===
"OR")c={};jQuery.each(i.rules,function(b,a){if(a.op==="in"||a.op==="ni")a.data=a.data.split(",").join("|");c=m[a.op].not?p==="OR"?h.from(c).union(h.from(k).not()[m[a.op].method](a.field,a.data).select()).select():h.from(c).not()[m[a.op].method](a.field,a.data).select():p==="OR"?h.from(c).union(h.from(k)[m[a.op].method](a.field,a.data).select()).select():h.from(c)[m[a.op].method](a.field,a.data).select()})}}else k[0]!==undefined&&jQuery.each(k[0],function(b){if(e[b]!==undefined){var a=false;if(jQuery("#regexp_"+
f.jqgrid.id)!==undefined&&jQuery("#regexp_"+f.jqgrid.id).is(":checked"))a=true;var d=false;jQuery.each(f.configuration.colModel,function(g,q){if(q.editoptions!==undefined&&b===q.name)d=true});c=a||d?h.from(c).match(b,e[b]).select():h.from(c).contains(b,e[b]).select()}});c=c.filter(function(b,a,d){return a==d.indexOf(b)&&!jQuery.isEmptyObject(b)});var r=e.sidx;i=e.sord;jQuery.each(f.configuration.colModel,function(b,a){if(a.name===r&&(a.sorttype==="integer"||a.sorttype==="int"))jQuery.each(c,function(d,
g){d=parseInt(g[r],10);isNaN(d)||(g[r]=d)})});i=i==="asc"?"":"-";if(c.length>0)c=h.from(c).ignoreCase().orderBy(i+r).select();f.data.filtered_data=c;if(e.rows===-1)e.rows=f.data.filtered_data.length;i=(e.page-1)*e.rows;for(var u=e.page*e.rows-1,s={page:e.page,total:c.length===0?0:Math.ceil(c.length/e.rows),records:c.length,rows:[]},l=i;l<=u;l++)if(c[l]!==undefined){var t=[];k[0]!==undefined&&jQuery.each(f.configuration.colModel,function(b,a){var d;b=f.data.all_data;for(var g=0;g<b.length;g++)if(b[g].columns.key===
c[l].key){d=b[g];break}b=c[l][a.name];if(d&&d.operations!==undefined&&d.operations.row!==undefined&&d.operations.row.link!==undefined){a=a.editable||false;if(b!==null&&b!==undefined&&!a&&b.toString().match(/<a\b[^>]*>.*<\/a>/)===null)b='<a style="display:block;" href="'+d.operations.row.link+'" class="listsnoul">'+b+"</a>"}b!==null&&t.push(b)});s.rows.push({key:c[l].key,cell:t})}var j=jQuery("#"+f.jqgrid.id);j[0].addJSONData(s);var n=f.configuration.colModel;jQuery.each(n,function(b,a){if(a.extra!==
undefined){var d=0,g=0;jQuery.each(a.extra,function(q,v){e[q]===v&&d++;g++});if(d!==g){n[b].hidden=true;n[b].hidedlg=true;j.jqGrid("getColProp",a.name).hidedlg=true;b=j.jqGrid("getGridParam","width");j.jqGrid("hideCol",a.name)}else{n[b].hidden=false;n[b].hidedlg=false;j.jqGrid("getColProp",a.name).hidedlg=false;b=j.jqGrid("getGridParam","width");j.jqGrid("showCol",a.name)}j.jqGrid("setGridWidth",b)}})}})();
