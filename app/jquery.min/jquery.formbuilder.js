(function(a){a.fn.formbuilder=function(p){var h=a.extend({save_url:false,load_url:false},p);return this.each(function(){var i=this,b="",k="",j=1;a(i).html("");h.load_url&&a.ajax({type:"GET",url:h.load_url,success:function(e){var d="",g=false;a(e).find("field").each(function(){if(a(this).attr("type")=="checkbox"){g=[];g[0]=a(this).attr("title");d=[];a(this).find("checkbox").each(function(f){d[f]=new Array(2);d[f][0]=a(this).text();d[f][1]=a(this).attr("checked")})}else if(a(this).attr("type")=="radio"){g=
[];g[0]=a(this).attr("title");d=[];a(this).find("radio").each(function(f){d[f]=new Array(2);d[f][0]=a(this).text();d[f][1]=a(this).attr("checked")})}else if(a(this).attr("type")=="select"){g=[];g[0]=a(this).attr("title");g[1]=a(this).attr("multiple");d=[];a(this).find("option").each(function(f){d[f]=new Array(2);d[f][0]=a(this).text();d[f][1]=a(this).attr("checked")})}else d=a(this).text();r(a(this).attr("type"),d,g,a(this).attr("required"))})}});a(this).after(a('<div class="clearfix"><button id="save-form" type="submit" name="submit">Save</button> <button id="preview-form" type="submit" name="submit">Preview</button></div>').click(function(){t();
return false}));var l="";l+='<option value="0">Add New Field...</option>';l+='<option value="input_text">Text</option>';l+='<option value="textarea">Paragraph</option>';l+='<option value="checkbox">Checkboxes</option>';l+='<option value="radio">Radio</option>';l+='<option value="select">Select List</option>';a(this).before('<select name="field_control_top" class="field_control">'+l+"</select>");a(this).after('<select name="field_control_bot" class="field_control">'+l+"</select>");a(".field_control").change(function(){r(a(this).val());
a(this).val(0).blur();a().scrollTo(a("#frm-"+(j-1)+"-item"),800);return false});var r=function(e,d,g,f){b="";k=e;if(typeof d=="undefined")d="";switch(e){case "input_text":u(d,f);break;case "textarea":v(d,f);break;case "checkbox":w(d,g,f);break;case "radio":x(d,g,f);break;case "select":y(d,g,f);break}},u=function(e,d){b+="<label>Label:</label>";b+='<input class="fld-title" id="title-'+j+'" type="text" value="'+e+'" />';help="";m("Text Field",b,d,help)},v=function(e,d){b+="<label>Label:</label>";b+=
'<input type="text" value="'+e+'" />';help="";m("Paragraph Field",b,d,help)},w=function(e,d,g){var f="";if(typeof d=="object")f=d[0];b+='<div class="chk_group">';b+='<div class="frm-fld"><label>Title:</label>';b+='<input type="text" name="title" value="'+f+'" /></div>';b+='<div class="false-label">Select Options</div>';b+='<div class="fields">';if(typeof e=="object")for(c in e)b+=n(e[c]);else b+=n("");b+='<div class="add-area"><a href="#" class="add add_ck">Add</a></div>';b+="</div>";b+="</div>";
help="";m("Checkbox Group",b,g,help);a(".add_ck").live("click",function(){a(this).parent().before(n());return false})},n=function(e){var d=false;if(typeof e=="object"){var g=e[0];d=e[1]=="false"?false:true}else g="";b="";b+="<div>";b+='<input type="checkbox"'+(d?' checked="checked"':"")+' /><input type="text" value="'+g+'" />';b+='<a href="#" class="remove" title="Are you sure you want to remove this checkbox?">x</a>';b+="</div>";return b},x=function(e,d,g){var f="";if(typeof d=="object")f=d[0];b+=
'<div class="rd_group">';b+='<div class="frm-fld"><label>Title:</label>';b+='<input type="text" name="title" value="'+f+'" /></div>';b+='<div class="false-label">Select Options</div>';b+='<div class="fields">';if(typeof e=="object")for(c in e)b+=o(e[c],"frm-"+j+"-fld");else b+=o("","frm-"+j+"-fld");b+='<div class="add-area"><a href="#" class="add add_rd">Add</a></div>';b+="</div>";b+="</div>";help="";m("Radio Group",b,g,help);a(".add_rd").live("click",function(){a(this).parent().before(o(false,a(this).parents(".frm-holder").attr("id")));
return false})},o=function(e,d){var g=false;if(typeof e=="object"){var f=e[0];g=e[1]=="false"?false:true}else f="";b="";b+="<div>";b+='<input type="radio"'+(g?' checked="checked"':"")+' name="radio_'+d+'" /><input type="text" value="'+f+'" />';b+='<a href="#" class="remove" title="Are you sure you want to remove this radio button option?">x</a>';b+="</div>";return b},y=function(e,d,g){var f=false,s="";if(typeof d=="object"){s=d[0];f=d[1]=="true"?true:false}b+='<div class="opt_group">';b+='<div class="frm-fld"><label>Title:</label>';
b+='<input type="text" name="title" value="'+s+'" /></div>';b+="";b+='<div class="false-label">Select Options</div>';b+='<div class="fields">';b+='<input type="checkbox" name="multiple"'+(f?'checked="checked"':"")+'><label class="auto">Allow Multiple Selections</label>';if(typeof e=="object")for(c in e)b+=q(e[c],f);else b+=q("",f);b+='<div class="add-area"><a href="#" class="add add_opt">Add</a></div>';b+="</div>";b+="</div>";help="";m("Select List",b,g,help);a(".add_opt").live("click",function(){a(this).parent().before(q("",
f));return false})},q=function(e,d){return d?n(e):o(e)},m=function(e,d,g){if(g)g=g=="true"?true:false;d="";d+='<li id="frm-'+j+'-item" class="'+k+'">';d+='<div class="legend"><a id="frm-'+j+'" class="toggle-form" href="#">Hide</a> <strong id="txt-title-'+j+'">'+e+"</strong></div>";d+='<div id="frm-'+j+'-fld" class="frm-holder">';d+='<div class="frm-elements clearfix">';d+=b;d+='<div class="frm-fld frm-help clearfix"><label for="help-'+j+'">Help Text:</label><input type="text" value="" name="required-'+
j+'" id="help-'+j+'" class="help"></div>';d+='<div class="frm-fld frm-require clearfix"><label for="required-'+j+'">Required?</label><input class="required" type="checkbox" value="1" name="required-'+j+'" id="required-'+j+'"'+(g?' checked="checked"':"")+" /></div>";d+="</div>";d+='<a id="del_'+j+'" class="del-button delete-confirm" href="#"  title="Are you sure you want to delete this form section?"><span>Delete</span></a>';d+="</div>";d+="</li>";a(i).append(d);a("#frm-"+j+"-item").hide();a("#frm-"+
j+"-item").animate({opacity:"show",height:"show"},"slow");j++};a(".remove").live("click",function(){a(this).parent("div").animate({opacity:"hide",height:"hide",marginBottom:"0px"},"fast",function(){a(this).remove()});return false});a(".toggle-form").live("click",function(){var e=a(this).attr("id");if(a(this).html()=="Hide"){a(this).removeClass("open").addClass("closed").html("Show");a("#"+e+"-fld").animate({opacity:"hide",height:"hide"},"slow");return false}if(a(this).html()=="Show"){a(this).removeClass("closed").addClass("open").html("Hide");
a("#"+e+"-fld").animate({opacity:"show",height:"show"},"slow");return false}return false});a(".delete-confirm").live("click",function(){var e=a(this).attr("id").replace(/del_/,"");confirm(a(this).attr("title"))&&a("#frm-"+e+"-item").animate({opacity:"hide",height:"hide",marginBottom:"0px"},"slow",function(){a(this).remove()});return false});var t=function(){h.save_url&&a.ajax({type:"POST",url:h.save_url,data:{form:a(i).serializeFormList(),xsrf_token:window.xsrf_token},success:function(){}})}})}})(jQuery);
(function(a){a.fn.serializeFormList=function(p){var h=a.extend({prepend:"ul",is_child:false,attributes:["class"]},p),i="";if(!h.is_child)h.prepend="&"+h.prepend;this.each(function(){var b=0;a(this).children().each(function(){for(att in h.attributes){i+=h.prepend+"["+b+"]["+h.attributes[att]+"]="+escape(a(this).attr(h.attributes[att]));if(h.attributes[att]=="class"){i+=h.prepend+"["+b+"][required]="+escape(a("#"+a(this).attr("id")+" input.required").attr("checked"));switch(a(this).attr(h.attributes[att])){case "input_text":i+=
h.prepend+"["+b+"][values]="+escape(a("#"+a(this).attr("id")+" input[type=text]").val());break;case "textarea":i+=h.prepend+"["+b+"][values]="+escape(a("#"+a(this).attr("id")+" input[type=text]").val());break;case "checkbox":var k=1;a("#"+a(this).attr("id")+" input[type=text]").each(function(){if(a(this).attr("name")=="title")i+=h.prepend+"["+b+"][title]="+escape(a(this).val());else{i+=h.prepend+"["+b+"][values]["+k+"][value]="+escape(a(this).val());i+=h.prepend+"["+b+"][values]["+k+"][default]="+
a(this).prev().attr("checked")}k++});break;case "radio":k=1;a("#"+a(this).attr("id")+" input[type=text]").each(function(){if(a(this).attr("name")=="title")i+=h.prepend+"["+b+"][title]="+escape(a(this).val());else{i+=h.prepend+"["+b+"][values]["+k+"][value]="+escape(a(this).val());i+=h.prepend+"["+b+"][values]["+k+"][default]="+a(this).prev().attr("checked")}k++});break;case "select":k=1;i+=h.prepend+"["+b+"][multiple]="+a("#"+a(this).attr("id")+" input[name=multiple]").attr("checked");a("#"+a(this).attr("id")+
" input[type=text]").each(function(){if(a(this).attr("name")=="title")i+=h.prepend+"["+b+"][title]="+escape(a(this).val());else{i+=h.prepend+"["+b+"][values]["+k+"][value]="+escape(a(this).val());i+=h.prepend+"["+b+"][values]["+k+"][default]="+a(this).prev().attr("checked")}k++});break}}}b++})});return i}})(jQuery);
