(function(a){a.fn.formbuilder=function(s){var d=a.extend({save_url:false,load_url:false,control_box_target:false,useJson:true,serialize_prefix:"frmb",options_wrap_class:"options-wrap",messages:{save:"Save",add_new_field:"Add New Field...",text:"Text Field",title:"Title",paragraph:"Paragraph",checkboxes:"Checkboxes",radio:"Radio",select:"Select List",text_field:"Text Field",label:"Label",paragraph_field:"Paragraph Field",select_options:"Select Options",add:"Add",checkbox_group:"Checkbox Group",remove_message:"Are you sure you want to remove this element?",
remove:"X",radio_group:"Radio Group",selections_message:"Allow Multiple Selections",hide:"Hide",required:"Required",show:"Show"}},s),n="frmb-"+a("ul[id^=frmb-]").length++;return this.each(function(){var m=a(this).append('<ul id="'+n+'" class="frmb"></ul>').find("ul"),b="",j="",k=1,l;a(m).addClass(n);(function(g){var e="",c="",f="",h=n+"-control-box",o=n+"-save-button";e+='<option value="0">'+d.messages.add_new_field+"</option>";e+='<option value="input_text">'+d.messages.text+"</option>";e+='<option value="textarea">'+
d.messages.paragraph+"</option>";e+='<option value="checkbox">'+d.messages.checkboxes+"</option>";e+='<option value="radio">'+d.messages.radio+"</option>";c='<select id="'+h+'" class="frmb-control">'+e+"</select>";f='<input type="submit" id="'+o+'" class="frmb-submit" value="'+d.messages.save+'"/>';g?a(g).append(c):a(m).before(c);a(m).after(f);a("#"+o).click(function(){a("#schema").attr("value",JSON.stringify(a(m).serializeFormList()));a("#form").submit();return true});a("#"+h).change(function(){var u=
"frm-t"+(new Date).getTime().toString()+"-item";v(u,a(this).val());a(this).val(0).blur();a("body").animate({scrollTop:a("#"+u).offset().top},500);return false})})(d.control_box_target);var x=function(g){var e="",c=false;a(g[0]).each(function(){var f=g[1][this.valueOf()];if(f.field_type==="input_text")c=[f.label];if(f.field_type==="textarea")c=[f.label];else if(f.field_type==="checkbox"){c=[f.label];e=[];a.each(f.values,function(){e.push([this.value,this.checked])})}else if(f.field_type==="radio"){c=
[f.label];e=[];a.each(f.values,function(){e.push([this.value,this.checked])})}else if(f.field_type==="select"){c=[f.label,f.multiple];e=[];a.each(f.values,function(){e.push([this.value,this.checked])})}else e=[f.values];v(this,f.field_type,e,c,f.required)})},v=function(g,e,c,f,h){b="";j=e;if(typeof c==="undefined")c="";switch(e){case "input_text":y(g,c,f,h);break;case "textarea":z(g,c,f,h);break;case "checkbox":A(g,c,f,h);break;case "radio":B(g,c,f,h);break;case "select":C(g,c,f,h);break}},y=function(g,
e,c,f){e="";if(typeof c==="object")e=c[0];b+="<label>"+d.messages.label+"</label>";b+='<input class="fld-label" id="label-'+k+'" type="text" value="'+unescape(e)+'" />';l="";p(g,d.messages.text,b,f,l)},z=function(g,e,c,f){e="";if(typeof c==="object")e=c[0];b+="<label>"+d.messages.label+"</label>";b+='<input type="text" value="'+unescape(e)+'" />';l="";p(g,d.messages.paragraph_field,b,f,l)},A=function(g,e,c,f){var h="";if(typeof c==="object")h=c[0];b+='<div class="chk_group">';b+='<div class="frm-fld"><label>'+
d.messages.label+"</label>";b+='<input type="text" name="label" value="'+unescape(h)+'" /></div>';b+='<div class="false-label">'+d.messages.select_options+"</div>";b+='<div class="fields '+d.options_wrap_class+'">';if(typeof e==="object")for(i=0;i<e.length;i++)b+=q(e[i]);else b+=q("");b+='<div class="add-area"><a href="#" class="add add_ck">'+d.messages.add+"</a></div>";b+="</div>";b+="</div>";l="";p(g,d.messages.checkbox_group,b,f,l)},q=function(g){var e=false,c="";if(typeof g==="object"){c=g[0];
e=g[1]==="false"?false:true}b="";b+="<div>";b+='<input type="checkbox"'+(e?' checked="checked"':"")+" />";b+='<input type="text" value="'+unescape(c)+'" />';b+='<a href="#" class="remove" title="'+d.messages.remove_message+'">'+d.messages.remove+"</a>";b+="</div>";return b},B=function(g,e,c,f){var h="";if(typeof c==="object")h=c[0];b+='<div class="rd_group">';b+='<div class="frm-fld"><label>'+d.messages.label+"</label>";b+='<input type="text" name="label" value="'+unescape(h)+'" /></div>';b+='<div class="false-label">'+
d.messages.select_options+"</div>";b+='<div class="fields '+d.options_wrap_class+'">';if(typeof e==="object")for(i=0;i<e.length;i++)b+=r(e[i],"frm-"+k+"-fld");else b+=r("","frm-"+k+"-fld");b+='<div class="add-area"><a href="#" class="add add_rd">'+d.messages.add+"</a></div>";b+="</div>";b+="</div>";l="";p(g,d.messages.radio_group,b,f,l)},r=function(g,e){var c=false,f="";if(typeof g==="object"){f=g[0];c=g[1]==="false"?false:true}b="";b+="<div>";b+='<input type="radio"'+(c?' checked="checked"':"")+
' name="radio_'+e+'" />';b+='<input type="text" value="'+unescape(f)+'" />';b+='<a href="#" class="remove" title="'+d.messages.remove_message+'">'+d.messages.remove+"</a>";b+="</div>";return b},C=function(g,e,c,f){var h=false,o="";if(typeof c==="object"){o=c[0];h=c[1]==="true"?true:false}b+='<div class="opt_group">';b+='<div class="frm-fld"><label>'+d.messages.label+"</label>";b+='<input type="text" name="label" value="'+unescape(o)+'" /></div>';b+="";b+='<div class="false-label">'+d.messages.select_options+
"</div>";b+='<div class="fields '+d.options_wrap_class+'">';b+='<input type="checkbox" name="multiple"'+(h?'checked="checked"':"")+">";b+='<label class="auto">'+d.messages.selections_message+"</label>";if(typeof e==="object")for(i=0;i<e.length;i++)b+=t(e[i],h);else b+=t("",h);b+='<div class="add-area"><a href="#" class="add add_opt">'+d.messages.add+"</a></div>";b+="</div>";b+="</div>";l="";p(g,d.messages.select,b,f,l)},t=function(g,e){return e?q(g):r(g)},p=function(g,e,c,f){if(f)f=f===true?true:
false;c="";c+='<li id="'+g+'" class="'+j+'">';c+='<div class="legend">';c+='<a id="frm-'+k+'" class="toggle-form" href="#">'+d.messages.hide+"</a> ";c+='<strong id="txt-label-'+k+'">'+e+"</strong></div>";c+='<div id="frm-'+k+'-fld" class="frm-holder">';c+='<div class="frm-elements">';c+=b;c+='<div class="frm-fld frm-fld-req"><label for="required-'+k+'">'+d.messages.required+"</label>";c+='<input class="required" type="checkbox" value="1" name="required-'+k+'" id="required-'+k+'"'+(f?' checked="checked"':
"")+" /></div>";c+='<a id="del_'+g+'" class="del-button delete-confirm" href="#" label="'+d.messages.remove_message+'"><span>Delete</span></a>';c+="</div>";c+="</div>";c+="</li>";a(m).append(c);a("#frm-"+k+"-item").hide();a("#frm-"+k+"-item").animate({opacity:"show",height:"show"},"slow");k++},w=a("#schema").attr("value");w&&x(JSON.parse(w));a(".remove").live("click",function(){a(this).parent("div").animate({opacity:"hide",height:"hide",marginBottom:"0px"},"fast",function(){a(this).remove()});return false});
a(".toggle-form").live("click",function(){var g=a(this).attr("id");if(a(this).html()===d.messages.hide){a(this).removeClass("open").addClass("closed").html(d.messages.show);a("#"+g+"-fld").animate({opacity:"hide",height:"hide"},"slow");return false}if(a(this).html()===d.messages.show){a(this).removeClass("closed").addClass("open").html(d.messages.hide);a("#"+g+"-fld").animate({opacity:"show",height:"show"},"slow");return false}return false});a(".delete-confirm").live("click",function(){var g=a(this).attr("id").replace(/del_/,
"");confirm(a(this).attr("label"))&&a("#"+g).animate({opacity:"hide",height:"hide",marginBottom:"0px"},"slow",function(){a(this).remove()});return false});a(".add_ck").live("click",function(){a(this).parent().before(q());return false});a(".add_opt").live("click",function(){a(this).parent().before(t("",false));return false});a(".add_rd").live("click",function(){a(this).parent().before(r(false,a(this).parents(".frm-holder").attr("id")));return false})})}})(jQuery);
(function(a){a.fn.serializeFormList=function(s){var d=a.extend({prepend:"ul",is_child:false,attributes:["class"],serialization_attributes:["field_type"]},s),n={},m=[];if(!d.is_child)d.prepend="&"+d.prepend;this.each(function(){a(this).children().each(function(){for(att in d.attributes){var b={};b[d.serialization_attributes[att]]=escape(a(this).attr(d.attributes[att]));if(d.attributes[att]=="class"){b.required=a("#"+a(this).attr("id")+" input.required").attr("checked");switch(a(this).attr(d.attributes[att])){case "input_text":b.label=
escape(a("#"+a(this).attr("id")+" input[type=text]").val());break;case "textarea":b.label=escape(a("#"+a(this).attr("id")+" input[type=text]").val());break;case "checkbox":b.values=[];a("#"+a(this).attr("id")+" input[type=text]").each(function(){if(a(this).attr("name")=="label")b.label=escape(a(this).val());else{var j={};j.value=escape(a(this).val());j.checked=a(this).prev().attr("checked");b.values.push(j)}});break;case "radio":b.values=[];a("#"+a(this).attr("id")+" input[type=text]").each(function(){if(a(this).attr("name")==
"label")b.label=escape(a(this).val());else{var j={};j.value=escape(a(this).val());j.checked=a(this).prev().attr("checked");b.values.push(j)}});break;case "select":b.multiple=a("#"+a(this).attr("id")+" input[name=multiple]").attr("checked");a("#"+a(this).attr("id")+" input[type=text]").each(function(){if(a(this).attr("name")=="label")b.label=escape(a(this).val());else{var j={};j.value=escape(a(this).val());j.checked=a(this).prev().attr("checked");b.values.push(j)}});break}}n[a(this).attr("id")]=b;
m.push(a(this).attr("id"))}})});return[m,n]}})(jQuery);
