(function(a){a.jgrid.inlineEdit=a.jgrid.inlineEdit||{};a.jgrid.extend({editRow:function(c,d,b,i,q,l,s,n,t){var h={keys:d||false,oneditfunc:b||null,successfunc:i||null,url:q||null,extraparam:l||{},aftersavefunc:s||null,errorfunc:n||null,afterrestorefunc:t||null,restoreAfterError:true,mtype:"POST"},u=a.makeArray(arguments).slice(1),e;e=u[0]&&typeof u[0]=="object"&&!a.isFunction(u[0])?a.extend(a.jgrid.inlineEdit,h,u[0]):h;return this.each(function(){var g=this,f,o,w=0,x=null,v={},p,j;if(g.grid){p=a(g).jqGrid("getInd",
c,true);if(p!==false)if((a(p).attr("editable")||"0")=="0"&&!a(p).hasClass("not-editable-row")){j=g.p.colModel;a('td[role="gridcell"]',p).each(function(k){f=j[k].name;var A=g.p.treeGrid===true&&f==g.p.ExpandColumn;if(A)o=a("span:first",this).html();else try{o=a.unformat(this,{rowId:c,colModel:j[k]},k)}catch(r){o=j[k].edittype&&j[k].edittype=="textarea"?a(this).text():a(this).html()}if(f!="cb"&&f!="subgrid"&&f!="rn"){if(g.p.autoencode)o=a.jgrid.htmlDecode(o);v[f]=o;if(j[k].editable===true){if(x===null)x=
k;A?a("span:first",this).html(""):a(this).html("");var m=a.extend({},j[k].editoptions||{},{id:c+"_"+f,name:f});if(!j[k].edittype)j[k].edittype="text";if(o=="&nbsp;"||o=="&#160;"||o.length==1&&o.charCodeAt(0)==160)o="";m=a.jgrid.createEl(j[k].edittype,m,o,true,a.extend({},a.jgrid.ajaxOptions,g.p.ajaxSelectOptions||{}));a(m).addClass("editable");A?a("span:first",this).append(m):a(this).append(m);j[k].edittype=="select"&&typeof j[k].editoptions!=="undefined"&&j[k].editoptions.multiple===true&&typeof j[k].editoptions.dataUrl===
"undefined"&&a.browser.msie&&a(m).width(a(m).width());w++}}});if(w>0){v.id=c;g.p.savedRow.push(v);a(p).attr("editable","1");a("td:eq("+x+") input",p).focus();e.keys===true&&a(p).bind("keydown",function(k){if(k.keyCode===27){a(g).jqGrid("restoreRow",c,t);return false}if(k.keyCode===13){if(k.target.tagName=="TEXTAREA")return true;a(g).jqGrid("saveRow",c,e);return false}});a.isFunction(e.oneditfunc)&&e.oneditfunc.call(g,c)}}}})},saveRow:function(c,d,b,i,q,l,s){var n={successfunc:d||null,url:b||null,
extraparam:i||{},aftersavefunc:q||null,errorfunc:l||null,afterrestorefunc:s||null,restoreAfterError:true,mtype:"POST"},t=a.makeArray(arguments).slice(1),h;h=t[0]&&typeof t[0]=="object"&&!a.isFunction(t[0])?a.extend(a.jgrid.inlineEdit,n,t[0]):n;var u=false,e=this[0],g,f={},o={},w={},x,v,p;if(!e.grid)return u;p=a(e).jqGrid("getInd",c,true);if(p===false)return u;n=a(p).attr("editable");h.url=h.url?h.url:e.p.editurl;if(n==="1"){var j;a('td[role="gridcell"]',p).each(function(r){j=e.p.colModel[r];g=j.name;
if(g!="cb"&&g!="subgrid"&&j.editable===true&&g!="rn"&&!a(this).hasClass("not-editable-cell")){switch(j.edittype){case "checkbox":var m=["Yes","No"];if(j.editoptions)m=j.editoptions.value.split(":");f[g]=a("input",this).is(":checked")?m[0]:m[1];break;case "text":case "password":case "textarea":case "button":f[g]=a("input, textarea",this).val();break;case "select":if(j.editoptions.multiple){m=a("select",this);var z=[];f[g]=a(m).val();f[g]=f[g]?f[g].join(","):"";a("select option:selected",this).each(function(B,
C){z[B]=a(C).text()});o[g]=z.join(",")}else{f[g]=a("select option:selected",this).val();o[g]=a("select option:selected",this).text()}if(j.formatter&&j.formatter=="select")o={};break;case "custom":try{if(j.editoptions&&a.isFunction(j.editoptions.custom_value)){f[g]=j.editoptions.custom_value.call(e,a(".customelement",this),"get");if(f[g]===undefined)throw"e2";}else throw"e1";}catch(y){y=="e1"&&a.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+a.jgrid.edit.msg.nodefined,jQuery.jgrid.edit.bClose);
y=="e2"?a.jgrid.info_dialog(jQuery.jgrid.errors.errcap,"function 'custom_value' "+a.jgrid.edit.msg.novalue,jQuery.jgrid.edit.bClose):a.jgrid.info_dialog(jQuery.jgrid.errors.errcap,y.message,jQuery.jgrid.edit.bClose)}break}v=a.jgrid.checkValues(f[g],r,e);if(v[0]===false){v[1]=f[g]+" "+v[1];return false}if(e.p.autoencode)f[g]=a.jgrid.htmlEncode(f[g]);if(h.url!=="clientArray"&&j.editoptions&&j.editoptions.NullIfEmpty===true)if(f[g]==="")w[g]="null"}});if(v[0]===false){try{var k=a.jgrid.findPos(a("#"+
a.jgrid.jqID(c),e.grid.bDiv)[0]);a.jgrid.info_dialog(a.jgrid.errors.errcap,v[1],a.jgrid.edit.bClose,{left:k[0],top:k[1]})}catch(A){alert(v[1])}return u}n=e.p.prmNames;t=n.oper;k=n.id;if(f){f[t]=n.editoper;f[k]=c;if(typeof e.p.inlineData=="undefined")e.p.inlineData={};f=a.extend({},f,e.p.inlineData,h.extraparam)}if(h.url=="clientArray"){f=a.extend({},f,o);e.p.autoencode&&a.each(f,function(r,m){f[r]=a.jgrid.htmlDecode(m)});k=a(e).jqGrid("setRowData",c,f);a(p).attr("editable","0");for(n=0;n<e.p.savedRow.length;n++)if(e.p.savedRow[n].id==
c){x=n;break}x>=0&&e.p.savedRow.splice(x,1);a.isFunction(h.aftersavefunc)&&h.aftersavefunc.call(e,c,k);u=true;a(p).unbind("keydown")}else{a("#lui_"+e.p.id).show();w=a.extend({},f,w);w[k]=a.jgrid.stripPref(e.p.idPrefix,w[k]);a.ajax(a.extend({url:h.url,data:a.isFunction(e.p.serializeRowData)?e.p.serializeRowData.call(e,w):w,type:h.mtype,async:false,complete:function(r,m){a("#lui_"+e.p.id).hide();if(m==="success"){var z=true,y;if(a.isFunction(h.successfunc)){y=h.successfunc.call(e,r);if(a.isArray(y)){z=
y[0];f=y[1]?y[1]:f}else z=y}if(z===true){e.p.autoencode&&a.each(f,function(B,C){f[B]=a.jgrid.htmlDecode(C)});f=a.extend({},f,o);a(e).jqGrid("setRowData",c,f);a(p).attr("editable","0");for(m=0;m<e.p.savedRow.length;m++)if(e.p.savedRow[m].id==c){x=m;break}x>=0&&e.p.savedRow.splice(x,1);a.isFunction(h.aftersavefunc)&&h.aftersavefunc.call(e,c,r);u=true;a(p).unbind("keydown")}else{a.isFunction(h.errorfunc)&&h.errorfunc.call(e,c,r,m);h.restoreAfterError===true&&a(e).jqGrid("restoreRow",c,h.afterrestorefunc)}}},
error:function(r,m){a("#lui_"+e.p.id).hide();if(a.isFunction(h.errorfunc))h.errorfunc.call(e,c,r,m);else try{jQuery.jgrid.info_dialog(jQuery.jgrid.errors.errcap,'<div class="ui-state-error">'+r.responseText+"</div>",jQuery.jgrid.edit.bClose,{buttonalign:"right"})}catch(z){alert(r.responseText)}h.restoreAfterError===true&&a(e).jqGrid("restoreRow",c,h.afterrestorefunc)}},a.jgrid.ajaxOptions,e.p.ajaxRowOptions||{}))}}return u},restoreRow:function(c,d){var b={afterrestorefunc:d||null},i=a.makeArray(arguments).slice(1),
q;q=i[0]&&typeof i[0]=="object"&&!a.isFunction(i[0])?a.extend(a.jgrid.inlineEdit,b,i[0]):b;return this.each(function(){var l=this,s,n,t={};if(l.grid){n=a(l).jqGrid("getInd",c,true);if(n!==false){for(var h=0;h<l.p.savedRow.length;h++)if(l.p.savedRow[h].id==c){s=h;break}if(s>=0){if(a.isFunction(a.fn.datepicker))try{a("input.hasDatepicker","#"+a.jgrid.jqID(n.id)).datepicker("hide")}catch(u){}a.each(l.p.colModel,function(){if(this.editable===true&&this.name in l.p.savedRow[s]&&!a(this).hasClass("not-editable-cell"))t[this.name]=
l.p.savedRow[s][this.name]});a(l).jqGrid("setRowData",c,t);a(n).attr("editable","0").unbind("keydown");l.p.savedRow.splice(s,1);a("#"+a.jgrid.jqID(c),"#"+a.jgrid.jqID(l.p.id)).hasClass("jqgrid-new-row")&&setTimeout(function(){a(l).jqGrid("delRowData",c)},0)}a.isFunction(q.afterrestorefunc)&&q.afterrestorefunc.call(l,c)}}})},addRow:function(c){c=a.extend({rowID:"new_row",initdata:{},position:"first",useDefValues:false,useFormatter:false,addRowParams:{extraparam:{}}},c||{});return this.each(function(){if(this.grid){var d=
this;c.useDefValues===true&&a(d.p.colModel).each(function(){if(this.edioptions&&this.editoptions.defaultValue){var i=this.editoptions.defaultValue;i=a.isFunction(i)?i.call(d):i;c.initdata[this.name]=i}});a(d).jqGrid("addRowData",c.rowID,c.initdata,c.position);a("#"+a.jgrid.jqID(c.rowID),"#"+a.jgrid.jqID(d.p.id)).addClass("jqgrid-new-row");if(c.useFormatter)a("#"+a.jgrid.jqID(c.rowID)+" .ui-inline-edit","#"+a.jgrid.jqID(d.p.id)).click();else{var b=d.p.prmNames;c.addRowParams.extraparam[b.oper]=b.addoper;
a(d).jqGrid("editRow",c.rowID,c.addRowParams);a(d).jqGrid("setSelection",c.rowID)}}})},inlineNav:function(c,d){d=a.extend({edit:true,editicon:"ui-icon-pencil",add:true,addicon:"ui-icon-plus",save:true,saveicon:"ui-icon-disk",cancel:true,cancelicon:"ui-icon-cancel",addParams:{useFormatter:false},editParams:{}},a.jgrid.nav,d||{});return this.each(function(){if(this.grid){var b=this;if(d.addParams.useFormatter===true){var i=b.p.colModel,q;for(q=0;q<i.length;q++)if(i[q].formatter&&i[q].formatter==="actions"){if(i[q].formatoptions){i=
a.extend({keys:false,onEdit:null,onSuccess:null,afterSave:null,onError:null,afterRestore:null,extraparam:{},url:null},i[q].formatoptions);d.addParams.addRowParams={keys:i.keys,oneditfunc:i.onEdit,successfunc:i.onSuccess,url:i.url,extraparam:i.extraparam,aftersavefunc:i.afterSavef,errorfunc:i.onError,afterrestorefunc:i.afterRestore}}break}}d.add&&a(b).jqGrid("navButtonAdd",c,{caption:d.addtext,title:d.addtitle,buttonicon:d.addicon,id:b.p.id+"_iladd",onClickButton:function(){a(b).jqGrid("addRow",d.addParams);
if(!d.addParams.useFormatter){a("#"+b.p.id+"_ilsave").removeClass("ui-state-disabled");a("#"+b.p.id+"_ilcancel").removeClass("ui-state-disabled");a("#"+b.p.id+"_iladd").addClass("ui-state-disabled");a("#"+b.p.id+"_iledit").addClass("ui-state-disabled")}}});d.edit&&a(b).jqGrid("navButtonAdd",c,{caption:d.edittext,title:d.edittitle,buttonicon:d.editicon,id:b.p.id+"_iledit",onClickButton:function(){var l=a(b).jqGrid("getGridParam","selrow");if(l){a(b).jqGrid("editRow",l,d.editParams);a("#"+b.p.id+"_ilsave").removeClass("ui-state-disabled");
a("#"+b.p.id+"_ilcancel").removeClass("ui-state-disabled");a("#"+b.p.id+"_iladd").addClass("ui-state-disabled");a("#"+b.p.id+"_iledit").addClass("ui-state-disabled")}else{a.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+b.p.id,jqm:true});a("#jqg_alrt").focus()}}});if(d.save){a(b).jqGrid("navButtonAdd",c,{caption:d.savetext||"",title:d.savetitle||"Save row",buttonicon:d.saveicon,id:b.p.id+"_ilsave",onClickButton:function(){var l=a(b).jqGrid("getGridParam","selrow");if(l){if(a("#"+a.jgrid.jqID(l),"#"+a.jgrid.jqID(b.p.id)).hasClass("jqgrid-new-row")){var s=
b.p.prmNames,n=s.oper;if(!d.editParams.extraparam)d.editParams.extraparam={};d.editParams.extraparam[n]=s.addoper}a(b).jqGrid("saveRow",l,d.editParams);a("#"+b.p.id+"_ilsave").addClass("ui-state-disabled");a("#"+b.p.id+"_ilcancel").addClass("ui-state-disabled");a("#"+b.p.id+"_iladd").removeClass("ui-state-disabled");a("#"+b.p.id+"_iledit").removeClass("ui-state-disabled")}else{a.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+b.p.id,jqm:true});a("#jqg_alrt").focus()}}});a("#"+b.p.id+"_ilsave").addClass("ui-state-disabled")}if(d.cancel){a(b).jqGrid("navButtonAdd",
c,{caption:d.canceltext||"",title:d.canceltitle||"Cancel row editing",buttonicon:d.cancelicon,id:b.p.id+"_ilcancel",onClickButton:function(){var l=a(b).jqGrid("getGridParam","selrow");if(l){a(b).jqGrid("restoreRow",l,d.editParams);a("#"+b.p.id+"_ilsave").addClass("ui-state-disabled");a("#"+b.p.id+"_ilcancel").addClass("ui-state-disabled");a("#"+b.p.id+"_iladd").removeClass("ui-state-disabled");a("#"+b.p.id+"_iledit").removeClass("ui-state-disabled")}else{a.jgrid.viewModal("#alertmod",{gbox:"#gbox_"+
b.p.id,jqm:true});a("#jqg_alrt").focus()}}});a("#"+b.p.id+"_ilcancel").addClass("ui-state-disabled")}}})}})})(jQuery);
